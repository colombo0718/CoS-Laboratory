<!DOCTYPE html>
<html>
<head>
    <title>CoS-Labs</title>
    <base href="app://./" />
</head>
<body>
    <div id="cont"></div>
    <script type="module">
        import * as THREE from './COS.js/three.js/three.module.js';
        import { MTLLoader } from './COS.js/three.js/MTLLoader.js';
        import { OBJLoader } from './COS.js/three.js/OBJLoader.js';

        var container, renderer;
        var scene, camera, light;

        var tileList=[]
        var map=[
            [1,1,1,1,1],
            [1,1,1,1,1],
            [1,1,1,1,1],
            [1,1,1,1,1,1]]
        var t0

        function init() {
            //
            renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth*.9, window.innerHeight*.9);

            container = document.getElementById( 'cont' );
            container.appendChild( renderer.domElement );

            scene=new THREE.Scene();
            light = new THREE.AmbientLight( 0xffffff,1);
            camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight,0.1, 2000 );
            camera.position.set(3,20,-20)
            camera.rotateY(-Math.PI)
            camera.rotateX(-2*Math.PI/8)
            
            scene.add( light );
            scene.add( camera );

            document.getElementById('cont').addEventListener('mousedown',onMouseDrag,false)
            document.getElementById('cont').addEventListener('mousemove',onMouseDrag,false)
            document.getElementById('cont').addEventListener('wheel',onMouseDrag,false)

            for(var j=0;j<map.length;j++){
                for(var i=0;i<map[0].length;i++){
                    addTile(i,j)
                }
            }
        }

        var addTile=function(i,j){
            new MTLLoader()
                .load('./tiles/soil.mtl', function ( materials ) {
                    new OBJLoader()
                        .setMaterials( materials )
                        .load('./tiles/soil.obj', function ( tile ) {
                            tile.position.set(i,0,j)
                            tile.scale.set(.25,.25,.25)
                            scene.add(tile)
                        })
                })
        }

        function onMouseDrag(event){
            // move camera -----------------------
            if(event.deltaY>0 && camera.position.y<50){
                camera.position.y+=1
                camera.position.z-=1
            }
            if(event.deltaY<0 && camera.position.y>2){
                camera.position.y-=1
                camera.position.z+=1
            }
            if(event.which==3){
                camera.position.x+=event.movementX/50
                camera.position.z+=event.movementY/50
            }
        }

        init()

        // setInterval(function(){
        //     renderer.render( scene,camera);
        //     // console.log(t0,tileList[0])
        // },50)

        function animate() {				
            // var delta = clock.getDelta();            
            // epic.peoples.children.forEach(function(element) {
            //     if(element.mixer!=undefined){
            //         element.mixer.update(delta)
            //     }
            // });
            renderer.render( scene, camera );
            requestAnimationFrame( animate );
        }
        animate()
    </script>
</body>